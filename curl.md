2021-06-14 19:07
#tag
# curl
```shell
curl опции ссылка
# опции:
    -#  #  отображать простой прогресс-бар во время загрузки;
    -0  #  использовать протокол http 1.0;
    -1  #  использовать протокол шифрования tlsv1;
    -2  #  использовать sslv2;
    -3  #  использовать sslv3;
    -4  #  использовать ipv4;
    -6  #  использовать ipv6;
    -A  #  указать свой USER\_AGENT;
    -b  #  сохранить Cookie в файл;
    -c  #  отправить Cookie на сервер из файла;
    -C  #  продолжить загрузку файла с места разрыва или указанного смещения;
    -m  #  максимальное время ожидания ответа от сервера;
    -d  #  отправить данные методом POST;
    -D  #  сохранить заголовки, возвращенные сервером в файл;
    -e  #  задать поле Referer-uri, указывает с какого сайта пришел пользователь;
    -E  #  использовать внешний сертификат SSL;
    -f  #  не выводить сообщения об ошибках;
    -F  #  отправить данные в виде формы;
    -G  #  если эта опция включена, то все данные, указанные в опции -d будут передаваться методом GET;
    -H  #  передать заголовки на сервер;
    -I  #  получать только HTTP заголовок, а все содержимое страницы игнорировать;
    -j  #  прочитать и отправить cookie из файла;
    -J  #  удалить заголовок из запроса;
    -L  #  принимать и обрабатывать перенаправления;
    -s  #  максимальное количество перенаправлений с помощью Location;
    -o  #  выводить контент страницы в файл;
    -O  #  сохранять контент в файл с именем страницы или файла на сервере;
    -p  #  использовать прокси;
    --proto  #  указать протокол, который нужно использовать;
    -R  #   сохранять время последнего изменения удаленного файла;
    -s  #  выводить минимум информации об ошибках;
    -S  #  выводить сообщения об ошибках;
    -T  #  загрузить файл на сервер;
    -v  #  максимально подробный вывод;
    -y  #  минимальная скорость загрузки;
    -Y  #  максимальная скорость загрузки;
    -z  #  скачать файл, только если он был модифицирован позже указанного времени;
    -V  #  вывести версию.
```

## Запрос страницы

Если никакие аргументы не указаны, то команда curl выполняет HTTP-запрос get и отображает статическое содержимое страницы. Оно аналогично тому, что мы видим при просмотре исходного кода в браузере.

curl www.google.com

## Скачивание файла

Есть два варианта этой команды.

-   Скачать файл и сохранить под оригинальным именем (testfile.tar.gz).

curl -O https://testdomain.com/testfile.tar.gz

-   Скачать файл и сохранить под другим именем.

curl -o custom_file.tar.gz https://testdomain.com/testfile.tar.gz

Еще можно скачать несколько файлов одной командой, хотя в мануале так делать не рекомендуют.

curl -O https://testdomain.com/testfile.tar.gz -O https://testdomain.com/testfile2.tar.gz

## Получение заголовков HTTP

Если вы хотите посмотреть, какие заголовки отдает сервер, то можно использовать опции -I или -head. Они позволяют получить заголовок без тела документа.
```shell
curl -I https://www.google.com 
HTTP/1.1 200 OK 
Content-Type: text/html; charset=ISO-8859-1
P3P: CP="This is not a P3P policy! See g.co/p3phelp for more info." 
Date: Thu, 04 Jun 2020 15:07:42 GMT 
Server: gws 
X-XSS-Protection: 0 X-Frame-Options: SAMEORIGIN Transfer-Encoding: chunked 
Expires: Thu, 04 Jun 2020 15:07:42 GMT 
Cache-Control: private 
Set-Cookie: 1P_JAR=2020-06-04-15; expires=Sat, 04-Jul-2020 15:07:42 GMT; path=/; domain=.google.com; Secure 
Set-Cookie: <cookie_info>
```
## Игнорирование ошибки неправильных или самоподписанных сертификатов

Когда вы тестируете веб-приложение или API, то в вашем тестовом окружении могут быть самоподписанные или неправильные SSL-сертификаты. По умолчанию curl верифицирует все сертификаты. Чтобы он не выдавал ошибку о неверных сертификатах и устанавливал соединение для тестирования, используйте опцию -k или -insecure.

curl -k https://localhost/my_test_endpoint

## Отправка POST-запроса

Иногда для тестирования API нужно отправить какие-либо данные, обычно это делают через POST-запрос. Если вы делаете POST-запрос при помощи curl, то можете отправить данные либо в виде списка имя=значение, либо в виде JSON.
```shell
#   Запрос в виде списка имя=значение.
curl --data "param1=test1&param2=test2" http://test.com
#   Запрос в виде JSON.
curl -H 'Content-Type: application/json' --data '{"param1":"test1","param2":"test2"}' http://www.test.com
```
Параметр --data эквивалентен -d, оба указывают curl выполнить HTTP POST-запрос.

## Указание типа запроса

Если curl не передаются никакие данные, то по умолчанию он выполняет HTTP GET запрос. Но если вам, например, нужно обновить данные, а не пересоздать их заново, то curl поддерживает опции, указывающие тип запроса. Параметры -x или --request позволяют указать тип HTTP-запроса, который используется для сообщения с сервером.

# updating the value of param2 to be test 3 on the record id curl -X 'PUT' -d '{"param1":"test1","param2":"test3"}' \http://test.com/1

## Использование авторизации

API защищено авторизацией по логину-паролю — вы можете передать пару логин-пароль, используя параметр -u или --user. Если просто передать логин, то curl запросит пароль в командной строке. Используете параметр несколько раз — для авторизации на сервер будет передано только последнее значение.

curl -u <user:password> https://my-test-api.com/endpoint1

## Управление резольвом имен

Вы хотите протестировать API перед развертыванием и перенаправить запрос на тестовую машину — это можно сделать, указав альтернативный резольв имени эндпоинта для данного запроса. Все работает эквивалентно пропиcыванию хоста в /etc/hosts.

curl --resolve www.test.com:80:localhost http://www.test.com/

## Загрузка файла

О возможности загрузки файла через curl я узнал недавно. Не был уверен, что это возможно, но, по всей видимости, это так: curl с опцией -F эмулирует отправку заполненной формы, когда пользователь нажимает кнопку отправки. Опция указывает curl передавать данные в виде POST-запроса, используя multipart / form-data Content-Type.

curl -F @field_name=@path/to/local_file

Вы можете загрузить несколько файлов, повторяя параметр -F.

curl -F @field_name=@path/to/local_file @field_name=@path/to/local_file_2

## Измерение продолжительности соединения

Вы можете использовать опцию -w для отображения информации в stdout после завершения передачи. Она поддерживает отображение набора переменных. Например, можно узнать общее время, которое потребовалось для успешного выполнения запроса. Это удобно, если вам нужно определить время загрузки или скачивания с помощью curl.

curl -w "%{time_total}\n" -o /dev/null -s www.test.com

Это некоторые из опций, которые можно использовать с curl. Надеюсь, информация была вам полезна и статья понравилась.
_____________
#### Links
[[Linux]]
[[Windows]]
https://vc.ru/dev/155069-10-komand-curl-kotorye-vam-sleduet-znat