2021-04-06 15:33
#tag
# Связь таблиц
#### «один ко многим»
```sql
'Один -связан со-> Многие  'OR'  Многие <-связаны с- Один
Многие <-связаны со-> Многие
Страна ---> Партия
Партия <---> Город
Рука ---> Палец
Преступник <---> Статья УК
Цезарь ---> Сенатор (цезарь как бы главнее сенатора, поэтому тыкает его копьём)'
```
## Создание таблицы с внешними ключами

```sql
# каждый внешний ключ должен иметь такой же тип данных, как связанное поле главной таблицы (в наших примерах это `INT`);
# необходимо указать главную для нее таблицу и столбец, по которому осуществляется связь:
FOREIGN KEY (связанное_поле_зависимой_таблицы)  
REFERENCES главная_таблица (связанное_поле_главной_таблицы)
"ПРИМЕР"
FOREIGN KEY (author_id)  REFERENCES author (author_id) 
```

По умолчанию любой столбец, кроме ключевого, может содержать значение `NULL`. При создании таблицы это можно переопределить,  используя  ограничение `NOT NULL` для этого столбца:

```sql
CREATE TABLE таблица (
    столбец_1 INT NOT NULL, 
    столбец_2 VARCHAR(10) 
);
# Для внешних ключей рекомендуется устанавливать ограничение `NOT NULL` (если это совместимо с другими опциями, которые будут рассмотрены в следующем шаге).
```

```sql
                                "EXAMPLE"
CREATE TABLE book (
    book_id INT PRIMARY KEY AUTO_INCREMENT, 
    title VARCHAR(50), 
    author_id INT NOT NULL, # пустое значение не допускается
    price DECIMAL(8,2), 
    amount INT, 
    # внешний ключ:  главная таблица author,  связанный столбец author.author_id
    FOREIGN KEY (author_id)  REFERENCES author (author_id) 
);
```
## [[Создание таблицы из данных другой]]
## удалении записи
`ON DELETE` => при удалении связанной строки из главной таблицы, выполняются аналогичное действие для записей подчиненной таблицы. опции:
-   `CASCADE`: автоматически удаляет строки из зависимой таблицы при удалении  связанных строк в главной таблице.
-   `SET NULL`: при удалении  связанной строки из главной таблицы устанавливает для столбца внешнего ключа значение **`NULL`**. (В этом случае столбец внешнего ключа должен поддерживать установку `ULL`).
-   `SET DEFAULT` похоже на `SET NULL` за тем исключением, что значение  внешнего ключа устанавливается не в `NULL,` а в значение по умолчанию для данного столбца.
-   `RESTRICT`: отклоняет удаление строк в главной таблице при наличии связанных строк в зависимой таблице.
**Важно!** Если для столбца установлена опция `SET NULL`, то при его описании нельзя задать ограничение на пустое значение.
```sql
CREATE TABLE book (
    book_id INT PRIMARY KEY AUTO_INCREMENT, 
    title VARCHAR(50), 
    author_id INT NOT NULL, 
    price DECIMAL(8,2), 
    amount INT, 
    FOREIGN KEY (author_id)  REFERENCES author (author_id) ON DELETE CASCADE
);
```
_____________
#### Links
[[SQL]]