2021-06-28 16:29
#tag
# Отладка ADB

```powershell
adb logcat [<Ключи>] [<фильтр>]
adb logcat -c							# отчистить лог
adb logcat -d -v time > file_name.txt	# save log in file_name(-d #с usb устройства )
```
### logcat Каждое сообщение лога в Android имеет тэг и приоритет  
Тэг – это строка указывающая компонент системы, от которого принято сообщение (например: View для системы view)  
Приоритет – имеет одно из нижеследующих значений (в порядке от меньшего к большему):  
V - Verbose (Низший приоритет).  
D - Debug  
I - Info  
W - Warning  
E - Error  
F - Fatal  
S - Silent (Наивысший приоритет, при котором ничего не выводится).  
  
Получить список тэгов, используемых в системе, вместе с их приоритетами можно запустив logcat. В первых двух столбцах каждого из выведенных сообщений будут указаны <приоритет>/<тэг>.  
Пример выводимого logcat сообщения:  
I/ActivityManager( 585): Starting activity: Intent { action=android.intent.action...}  
  
Для уменьшения вывода лога до приемлемого уровня нужно использовать выражения фильтра. Выражения фильтра позволяют указать системе нужные комбинации <тэг> и <приоритет>, остальные сообщения система не выводит.  
Выражения фильтра имеют следующий формат <тэг>:<приоритет> ..., где <тэг> указывает нужный тэг, <приоритет> указывает минимальный уровень приоритета для выбранного тэга. Сообщения с выбранным тэгом и приоритетом на уровне или выше указанного записываются в лог. Можно использовать любое количество пар <тэг>:<приоритет> в одном выражении фильтра. Для разделения пар <тэг>:<приоритет> используется пробел.  
  
Пример ниже выводит в лог все сообщения с тэгом "ActivityManager" с приоритетом "Info" или выше, и сообщения с тэгом "MyApp" и приоритетом "Debug" или выше:  
adb logcat ActivityManager:I MyApp:D *:S  
Последний элемент в выражении фильтра *:S устанавливает приоритет "silent" для всех остальных тэгов, тем самым обеспечивая вывод сообщений только для "View" и "MyApp". Использование *:S – это отличный способ для вывода в лог только явно указанных фильтров (т.е. в выражении фильтра указывается "белый список" сообщений, а *:S отправляет все остальное в "черный список").  
  
При помощи следующего выражения фильтра отображаются все сообщения с приоритетом "warning" или выше для всех тэгов:  
adb logcat *:W  
  
Если logcat запускается на машине разработчика (не через удаленный adb shell), можно также установить значение выражения фильтра по умолчанию задав переменную окружения ANDROID_LOG_TAGS:  
export ANDROID_LOG_TAGS="ActivityManager:I MyApp:D *:S"  
  
Следует обратить внимание что задав переменную окружения ANDROID_LOG_TAGS она не будет работать в эмуляторе/устройстве, если вы будете использовать logcat в удаленном shell или используя adb shell logcat.  
Вышеописанная команда export работает в ОС *nix и не работает в Windows.  
  
Контроль формата вывода лога  
  
Сообщения лога в дополнение к тэгу и приоритету содержат несколько полей метаданных. Можно изменять формат вывода сообщений показывая только конкретные поля метаданных. Для этого используется параметр -v и указывается один из ниже перечисленных форматов вывода.  
  
brief Показывать приоритет/тэг и PID процесса (формат по умолчанию).  
process Показывать только PID.  
tag Показывать только приоритет/тэг.  
thread Показывать только процесс:поток и приоритет/тэг.  
raw Показать необработанное сообщение, без полей метаданных.  
time Показывать дату, время вызова, приоритет/тэг и PID процесса.  
long Показывать все поля метаданных и отдельно сообщения с пустыми строками.  
  
При запуске logcat можно указать формат вывода используя параметр -v:  
adb logcat [-v <format>]  
Пример, который показывает сообщения в формате thread:  
adb logcat -v thread  
Нужно отметить, что можно использовать только один формат с параметром -v.  
  
Просмотр альтернативного буфера лога  
  
Система логов Android держит несколько кольцевых буферов для лога сообщений и не все сообщения отправляются в основной буфер. Для отображения дополнительных сообщений лога нужно запустить logcat с параметром -b.  
  
Таким образом можно посмотреть один из альтернативных буферов:  
radio Просмотр буфера с сообщениями связанными с радио/телефоном.  
events Просмотр буфера с сообщениями связанными с событиями.  
main Просмотр основного буфера (по умолчанию).  
  
Пример ниже показывает буфер с радио и телефонными сообщениями:  
adb logcat -b radio  
  
Просмотр stdout и stderr  
  
По умолчанию система Android шлет вывод stdout и stderr (System.out и System.err) в /dev/null (удаляет). В процессах, которые выполняются в виртуальной машине Dalvik (Dalvik VM) может осуществляться запись копии вывода в лог файл. В этом случае система записывает сообщения в лог используя тэги stdout и stderr с приоритетом I.  
Для перенаправления вывода нужно остановить эмулятор/устройство, затем выполнить команду shell setprop для включения перенаправления вывода. Пример того как это делается:  
$ adb shell stop  
$ adb shell setprop log.redirect-stdio true  
$ adb shell start  
Система сохраняет эту настройку, пока работает эмулятор/устройство. Чтобы использовать эту настройку по умолчанию в эмуляторе/устройстве, нужно добавить эту команду в /data/local.prop в эмуляторе/устройстве.  
  
Список параметров команды logcat  
-b <buffer> Загрузить альтернативный буфер лога для просмотра, такой как event или radio. Основной буфер используется по умолчанию.  
-c Очистить (сбросить) лог и выйти.  
-d Вывести лог на экран и выйти.  
-f <filename> Записать сообщения лога в файл <filename>. По умолчанию в stdout.  
-g Вывести размер указанного буфера лога и выйти.  
-n <count> Установить максимальное количество ротаций лога (количество хранимых сжатых фрагментов лога) <count>. По умолчанию 4. Требует параметр -r.  
-r <kbytes> Выполнять ротацию каждые <kbytes> вывода (разделять лог на фрагменты по <kbytes>). По умолчанию 16. Требует параметр -f.  
-s Устанавливает silent фильтром по умолчанию.  
-v <format> Устанавливает формат вывода сообщений лога. По умолчанию brief.
_____________
#### Links
https://4pda.to/forum/index.php?showtopic=383300