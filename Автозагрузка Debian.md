2021-02-10 13:53
#автозагрузка
# Автозагрузка Debian
#### [**Автозагрузка на уровне ядра** ](https://losst.ru/ustanavlivaem-parametry-yadra-v-grub)
С помощью параметра ядра init вы можете указать какую программу стоит запускать сразу после завершения инициализации ядра. Например, вы можете загрузить оболочку Bash вместо Systemd. Для этого достаточно подправить строку запуска ядра в конфигурационном файле Grub 
`sudo nano /boot/grub2/grub.cfg`или во время запуска. Добавьте в конец параметр init:
`linux /vmlinuz-4.8.0-22-generic root=/dev/mapper/systems-ubuntu ro quiet init=/bin/bash`
#### [**Автозагрузка системы инициализации** ](https://losst.ru/avtozagruzka-linux)
 на этапе инициализации системы с помощью системы инициализации. В systemd очень продвинутая система [управления службами](https://losst.ru/upravlenie-sluzhbami-linux). - зависимости, параллельный запуск, отсрочка запуска и перезапуск при ошибке. В терминологии `Systemd` все запускаемые программы представлены файлами юнитов, в каждом юните описаны параметры программы, ее исполняемый файл, а также дополнительные требования к запуску.
**Добавления или удаления служб** 
```bash
sudo systemctl enable имя_службы #  добавить службу в автозапуск 
sudo systemctl disable имя_службы #  отключить ее автозапуск linux
```
**Проверить добавлена ли уже служба в автозагрузку:**
```bash
sudo systemctl is-enabled имя_службы
systemctl list-unit-files | grep enabled # посмотреть все сервисы, которые были добавлены в автозагрузку с помощью 
systemctl list-units --type service --all #  Проверить статус (отображение статуса всех сервисов)  
```
_Управление загрузкой сервисов с системой инициализации upstart_  
``` bash
service --status-all  			  # Проверить статус (отображение статуса всех сервисов)
update-rc.d имя_сервиса defaults  #  Добавить в автозапуск  
update-rc.d -f имя_сервиса remove #  Удалить из автозапуска  
```

#### Автозагрузка `скриптов` в Linux
Раньше было принято размещать все скрипты, которые запускаются по умолчанию в файле /etc/rc.local. Этот файл все еще существует, но это пережиток системы инициализации SysVinit и теперь он сохраняется только для совместимости. Скрипты же нужно загружать только с помощью Systemd.
Для этого достаточно создать простой юнит-файл и добавить его в автозагрузку, как любой другой сервис. Сначала создадим этот файл:
```bash
sudo vi /lib/systemd/system/runscript.service
```
`[Unit]  
Description=My Script Service  
After=multi-user.target  
[Service]  
Type=idle  
ExecStart=/usr/bin/local/script.sh  
[Install]  
WantedBy=multi-user.target  
`
В секции **Unit** мы даем краткое описание нашему файлу и говорим с помощью опции **After**, что нужно запускать этот скрипт в многопользовательском режиме (multi-user). Секция **Service** самая важная, здесь мы указываем тип сервиса - **idle**, это значит, что нужно просто запустить и забыть, вести наблюдение нет необходимости, а затем в параметре **ExecStart** указываем полный путь к нашему скрипту.
Осталось выставить правильные права:
`sudo chmod 644 /lib/systemd/system/runscript.service`
Затем обновить конфигурацию и добавить в автозагрузку Linux новый скрипт:
`sudo systemctl daemon-reload`  
`sudo systemctl enable myscript.service`
После следующей перезагрузки этот скрипт будет запущен автоматически. Обратите внимание, что для каждого скрипта, который вы собираетесь запускать должны быть правильно выставлены права, а именно нужно установить флаг выполнения. Для этого используйте команду chmod:
`sudo chmod u+x /usr/local/bin/script`
В параметрах мы передаем утилите адрес файла скрипта. Исполняемость - это обязательный параметр для всех способов.

#### **Автозагрузка `менеджера входа`** 
вы можете выполнять свои скрипты или команды после запуска менеджера входа, но перед запуском окружения;
#### **Автозагрузка `X сервера`** 
запуск нужных программ или скрпитов сразу после старта X сервера;
Настроим автозапуск (при запуске граф процессора(`xorg`) i3wm)
```bash
echo 'exec i3' >> ~/.xinitrc #  создадим и отредактируем файл ~/.xinitrc, записав в него текст “exec i3”
```
#### **Автозагрузка `окружения`** 
большинство окружений поддерживают автозагрузку программ, там даже можно настроить отложенный запуск и другие параметры;
#### Автозагрузка **`bash`**
 Ваш скрипт или команда будет выполняться каждый раз, когда запускается новая сессия терминала. Для этого `добавьте адрес нужного скрипта` в файл `~/.bashrc`:
```bash
nano ~/.bashrc

/usr/bin/local/script  
export MYWAR=test
```
Здесь вы можете запускать на выполнение любые скрипты или команды. Часто такой подход используется для создания псевдонимов команд, объявления новых переменных и собственных функций.


[Уровни автозагрузки](https://habr.com/ru/sandbox/112588/)

_____________
#### Links
[[Linux]] [[Debian]]